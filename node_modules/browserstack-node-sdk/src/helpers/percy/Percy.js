const a55_0x34101f=a55_0x7ea4;(function(_0x48df3e,_0x55961f){const _0x3430cf=a55_0x7ea4,_0x4b4937=_0x48df3e();while(!![]){try{const _0x18d175=parseInt(_0x3430cf(0x1b0))/0x1+parseInt(_0x3430cf(0x15d))/0x2+parseInt(_0x3430cf(0x168))/0x3*(parseInt(_0x3430cf(0x15e))/0x4)+-parseInt(_0x3430cf(0x14f))/0x5*(parseInt(_0x3430cf(0x1a8))/0x6)+parseInt(_0x3430cf(0x1b1))/0x7*(parseInt(_0x3430cf(0x153))/0x8)+-parseInt(_0x3430cf(0x17e))/0x9+-parseInt(_0x3430cf(0x177))/0xa*(parseInt(_0x3430cf(0x144))/0xb);if(_0x18d175===_0x55961f)break;else _0x4b4937['push'](_0x4b4937['shift']());}catch(_0x24be70){_0x4b4937['push'](_0x4b4937['shift']());}}}(a55_0x1d0b,0xa56a2));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require('../helper'),logger=require(a55_0x34101f(0x1ad))[a55_0x34101f(0x18c)],{logDir}=require(a55_0x34101f(0x1ad)),PercyBinary=require(a55_0x34101f(0x147));class Percy{#logfile=path[a55_0x34101f(0x178)](logDir,a55_0x34101f(0x17c));#address=process[a55_0x34101f(0x16d)][a55_0x34101f(0x165)]||a55_0x34101f(0x160);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a55_0x34101f(0x194)]=![];constructor(_0x593ac0){const _0x289057=a55_0x34101f,_0x7bcbce={};_0x7bcbce[_0x289057(0x171)]=function(_0x479686,_0x32497b){return _0x479686===_0x32497b;},_0x7bcbce[_0x289057(0x138)]=_0x289057(0x166),_0x7bcbce[_0x289057(0x19c)]=_0x289057(0x1a7);const _0x41de27=_0x7bcbce;this.#config=_0x593ac0,!!_0x593ac0['app']&&(_0x41de27[_0x289057(0x171)](_0x41de27[_0x289057(0x138)],_0x41de27[_0x289057(0x19c)])?_0x2ccaa6[_0x289057(0x142)]='2':this.#isApp=!![]);}async #getBinaryPath(){const _0x5374b7=a55_0x34101f,_0x366566={};_0x366566[_0x5374b7(0x184)]=function(_0x1c1e1c,_0x44e527){return _0x1c1e1c===_0x44e527;},_0x366566[_0x5374b7(0x198)]=_0x5374b7(0x173);const _0x5d4be7=_0x366566;if(!this.#binaryPath){if(_0x5d4be7[_0x5374b7(0x184)](_0x5d4be7[_0x5374b7(0x198)],_0x5d4be7['KhFtA'])){const _0x495fee=new PercyBinary();this.#binaryPath=await _0x495fee[_0x5374b7(0x17b)](this.#config);}else return!![];}return this.#binaryPath;}async #sleep(_0x2721b9){return new Promise(_0xefd87f=>setTimeout(_0xefd87f,_0x2721b9));}async[a55_0x34101f(0x17d)](){const _0x40f7e7=a55_0x34101f,_0x7466be={'IUUsZ':function(_0xa20a9,_0x585d94){return _0xa20a9(_0x585d94);},'SSGyZ':function(_0x23b167,_0x1ec29b){return _0x23b167+_0x1ec29b;},'ZnqYv':_0x40f7e7(0x150),'CwpEb':function(_0x509dbd,_0x87db0){return _0x509dbd===_0x87db0;},'Hvyqs':_0x40f7e7(0x15b),'XenHy':_0x40f7e7(0x18d),'VPIBU':_0x40f7e7(0x1a6),'vWTPy':function(_0xd50d38,_0x4e521d){return _0xd50d38===_0x4e521d;},'pYMEh':'meuYb','qQWIG':function(_0xc77c67,_0x1a4395){return _0xc77c67===_0x1a4395;},'BNPnt':_0x40f7e7(0x1a4),'wLNDv':_0x40f7e7(0x135)};try{if(_0x7466be[_0x40f7e7(0x1a3)](_0x7466be['Hvyqs'],_0x7466be[_0x40f7e7(0x17f)])){const _0x384c73=await helper[_0x40f7e7(0x1a0)](_0x7466be[_0x40f7e7(0x140)],_0x7466be['VPIBU'],null,null,this.#address);if(_0x384c73)return _0x7466be[_0x40f7e7(0x159)](_0x7466be[_0x40f7e7(0x19e)],_0x7466be[_0x40f7e7(0x19e)])?!![]:this['isProcessRunning'];}else return![];}catch(_0x463f4c){if(_0x7466be[_0x40f7e7(0x15a)](_0x7466be[_0x40f7e7(0x170)],_0x7466be[_0x40f7e7(0x136)]))_0x1d7b2e['writeFile'](_0x347180,_0x10b478[_0x40f7e7(0x148)](_0x38de85),_0x37a51e=>{const _0x9c58fc=_0x40f7e7;_0x37a51e&&(_0x198eb1[_0x9c58fc(0x193)]('Error\x20creating\x20percy\x20config:\x20'+_0x37a51e),_0x7466be[_0x9c58fc(0x19f)](_0x4ea1ef,null)),_0x19262c[_0x9c58fc(0x14c)](_0x7466be[_0x9c58fc(0x167)](_0x7466be['ZnqYv'],_0x24b987)),_0x7466be[_0x9c58fc(0x19f)](_0x2ef791,_0xc38f65);});else return![];}}async[a55_0x34101f(0x17a)](){const _0x17874a=a55_0x34101f,_0x59e010={'cpSfB':function(_0x486d53,_0x40b1f5){return _0x486d53!==_0x40b1f5;},'HozTi':_0x17874a(0x16f),'KILuM':function(_0x1bd054,_0x43006a){return _0x1bd054(_0x43006a);},'DsiAB':function(_0x25f228,_0x27799c,_0x47abc6){return _0x25f228(_0x27799c,_0x47abc6);},'tAezX':'exec:stop','eRgGi':_0x17874a(0x158),'zBKqS':function(_0x2b4cb9,_0x3729a1){return _0x2b4cb9===_0x3729a1;},'UtXfU':_0x17874a(0x179),'rxrhP':'KQOkw','TRHhr':'app:exec','HKkpq':'exec','YczHc':_0x17874a(0x163),'qmMDK':function(_0x22c376,_0x11f845,_0x47d049,_0xa0785b){return _0x22c376(_0x11f845,_0x47d049,_0xa0785b);},'ccBRJ':function(_0x1d63f5,_0x1c6c19){return _0x1d63f5===_0x1c6c19;},'Qgrds':_0x17874a(0x146),'bQtRP':function(_0x4c7e95,_0x400de8){return _0x4c7e95!==_0x400de8;},'UnCak':_0x17874a(0x139),'zLIUt':_0x17874a(0x1a2),'CyVkY':'Percy\x20healthcheck\x20successful'},_0x5b5e7b=await this.#getBinaryPath(),_0x4f388f={};_0x4f388f[_0x17874a(0x199)]='a';const _0x5c196a=fs[_0x17874a(0x13a)](this.#logfile,_0x4f388f),_0x545324=await this[_0x17874a(0x182)](),_0x174666=await this['createPercyConfig']();if(!_0x545324)return _0x59e010['zBKqS'](_0x59e010[_0x17874a(0x16c)],_0x59e010['rxrhP'])?(_0x5376d7['error'](_0x17874a(0x175)+_0x55b8e8),null):![];const _0x2ae12f=[(this.#isApp?_0x59e010['TRHhr']:_0x59e010[_0x17874a(0x186)])+_0x17874a(0x156)];_0x174666&&(_0x59e010[_0x17874a(0x161)](_0x59e010[_0x17874a(0x13f)],_0x59e010[_0x17874a(0x13f)])?_0x4f74dc[_0x17874a(0x194)]=![]:_0x2ae12f[_0x17874a(0x19b)]('-c',_0x174666));const _0xa824b7={};_0xa824b7['PERCY_TOKEN']=_0x545324,this.#proc=_0x59e010[_0x17874a(0x1b3)](spawn,_0x5b5e7b,_0x2ae12f,{'env':Object[_0x17874a(0x13e)](process[_0x17874a(0x16d)],_0xa824b7)}),this.#proc['stdout'][_0x17874a(0x180)](_0x5c196a),this.#proc[_0x17874a(0x1b2)][_0x17874a(0x180)](_0x5c196a),this[_0x17874a(0x194)]=!![];var _0x2a64bd=this;this.#proc['on'](_0x59e010[_0x17874a(0x1a5)],function(_0x3f325e){const _0x182fb5=_0x17874a;if(_0x59e010[_0x182fb5(0x161)](_0x59e010[_0x182fb5(0x15f)],_0x59e010[_0x182fb5(0x15f)]))return new _0x2ead52(_0x8dec3c=>_0x2ed893(_0x8dec3c,_0x1c2131));else _0x2a64bd[_0x182fb5(0x194)]=![];});do{if(_0x59e010[_0x17874a(0x192)](_0x59e010[_0x17874a(0x16e)],_0x59e010[_0x17874a(0x16e)])){const _0x16fe4a=await this['healthcheck']();if(_0x16fe4a)return _0x59e010['bQtRP'](_0x59e010['UnCak'],_0x59e010['zLIUt'])?(logger[_0x17874a(0x14c)](_0x59e010[_0x17874a(0x18a)]),!![]):null;await this.#sleep(0x3e8);}else{const _0x1ed3bf=_0x59e010[_0x17874a(0x15c)](_0x2f115e,_0x222c17,[_0x59e010[_0x17874a(0x162)]]);_0x1ed3bf['on'](_0x59e010['eRgGi'],_0x41d7d5=>{const _0x456297=_0x17874a;this[_0x456297(0x194)]=![],_0x59e010[_0x456297(0x151)](_0x5097f6,_0x41d7d5);});}}while(this[_0x17874a(0x194)]);return![];}async[a55_0x34101f(0x157)](){const _0x795b6d=a55_0x34101f,_0x10f175={'UYoLq':_0x795b6d(0x155),'CWyEf':function(_0x436814,_0x41a008){return _0x436814(_0x41a008);},'lwVTl':function(_0x5c51ec,_0x239709){return _0x5c51ec===_0x239709;},'hhlXT':_0x795b6d(0x14a),'uwxBk':_0x795b6d(0x14e),'USudP':function(_0x38d76a,_0x29d0e4,_0x45e529){return _0x38d76a(_0x29d0e4,_0x45e529);},'MRJRR':'exec:stop','NLGWV':_0x795b6d(0x158)},_0x2cdc80=await this.#getBinaryPath();return new Promise((_0xe1d17b,_0x4b3ea7)=>{const _0x12350f=_0x795b6d,_0x54c3ad={'uJPaO':function(_0x483e6b,_0x547529){const _0x1dbca2=a55_0x7ea4;return _0x10f175[_0x1dbca2(0x152)](_0x483e6b,_0x547529);},'dVpSY':function(_0x42dc98,_0x51e898){return _0x10f175['lwVTl'](_0x42dc98,_0x51e898);},'XQdLz':_0x10f175[_0x12350f(0x1ac)]};if(_0x10f175[_0x12350f(0x13b)](_0x10f175[_0x12350f(0x134)],_0x10f175[_0x12350f(0x134)])){const _0x4d6776=_0x10f175[_0x12350f(0x196)](spawn,_0x2cdc80,[_0x10f175['MRJRR']]);_0x4d6776['on'](_0x10f175[_0x12350f(0x149)],_0xdbb1a0=>{const _0x2f689e=_0x12350f,_0x345719={'loVRm':function(_0x3c5c21,_0x55ddfb){const _0x3273e0=a55_0x7ea4;return _0x54c3ad[_0x3273e0(0x183)](_0x3c5c21,_0x55ddfb);}};_0x54c3ad[_0x2f689e(0x176)](_0x54c3ad['XQdLz'],_0x54c3ad[_0x2f689e(0x143)])?(this[_0x2f689e(0x194)]=![],_0x54c3ad[_0x2f689e(0x183)](_0xe1d17b,_0xdbb1a0)):(_0x15f980[_0x2f689e(0x193)](_0x2f689e(0x174)+_0x4d9637),_0x345719['loVRm'](_0x54019d,null));});}else return _0x283b4d[_0x12350f(0x14c)](_0x10f175[_0x12350f(0x16b)]),!![];});}['isRunning'](){return this['isProcessRunning'];}async[a55_0x34101f(0x182)](){const _0x1db5b6=a55_0x34101f,_0x435b0b={'LCWPR':function(_0x4d4878,_0x4bc1ba){return _0x4d4878(_0x4bc1ba);},'kNgqY':function(_0xcf6302,_0x477e58){return _0xcf6302!==_0x477e58;},'fKQjj':'JOajG','RBKqd':_0x1db5b6(0x190),'eLAXg':_0x1db5b6(0x14d),'BcpSx':_0x1db5b6(0x18d),'TmSbJ':_0x1db5b6(0x137),'DaZCs':function(_0x47f577,_0x4b110d){return _0x47f577===_0x4b110d;},'lcPNM':_0x1db5b6(0x13d),'nSRQK':'DyXrG'},_0x47bd1e=this.#config[_0x1db5b6(0x1ab)];try{if(_0x435b0b[_0x1db5b6(0x189)](_0x435b0b['fKQjj'],_0x435b0b['fKQjj']))_0x467012[_0x1db5b6(0x19b)]('-c',_0x4fbb1b);else{const _0x2e938c=this.#isApp?_0x435b0b[_0x1db5b6(0x14b)]:_0x435b0b[_0x1db5b6(0x18f)],_0x886f20=await helper[_0x1db5b6(0x1a0)](_0x435b0b[_0x1db5b6(0x1af)],_0x1db5b6(0x141)+_0x47bd1e+_0x1db5b6(0x145)+_0x2e938c,{},this.#config),_0x519e10=JSON['parse'](_0x886f20[_0x1db5b6(0x164)]);return logger['debug'](_0x435b0b[_0x1db5b6(0x1a9)]),_0x519e10['token'];}}catch(_0x2b5f5a){if(_0x435b0b[_0x1db5b6(0x195)](_0x435b0b['lcPNM'],_0x435b0b['nSRQK']))this[_0x1db5b6(0x194)]=![],_0x435b0b['LCWPR'](_0x47ee64,_0x337ea9);else return logger[_0x1db5b6(0x193)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x2b5f5a),null;}}async[a55_0x34101f(0x191)](){const _0x46ae5a=a55_0x34101f,_0x2ec3e7={'KzuzP':function(_0x33fe9a,_0x2ae191){return _0x33fe9a(_0x2ae191);},'QrYXU':function(_0x151816,_0x7d57ed){return _0x151816+_0x7d57ed;},'bNXvq':_0x46ae5a(0x150),'VlwZX':function(_0x236def,_0x194671){return _0x236def(_0x194671);},'uPfLK':function(_0x450cd9,_0x152cc3){return _0x450cd9+_0x152cc3;},'SgYcc':function(_0x1d4554,_0x55dcf8){return _0x1d4554===_0x55dcf8;},'JnimW':_0x46ae5a(0x1ae),'nNXRP':'percy.json','UDCCr':function(_0x1f90da,_0x150b80){return _0x1f90da!==_0x150b80;},'wCOzZ':_0x46ae5a(0x19a),'kOccw':_0x46ae5a(0x181)};if(!this.#config[_0x46ae5a(0x154)]){if(_0x2ec3e7[_0x46ae5a(0x1aa)](_0x2ec3e7[_0x46ae5a(0x185)],_0x2ec3e7[_0x46ae5a(0x185)]))return null;else _0x8a0d84&&(_0x23662c[_0x46ae5a(0x193)](_0x46ae5a(0x174)+_0x252e7f),_0x2ec3e7['KzuzP'](_0x11f806,null)),_0xb9e59b[_0x46ae5a(0x14c)](_0x2ec3e7[_0x46ae5a(0x19d)](_0x2ec3e7['bNXvq'],_0x3d5ec1)),_0x2ec3e7[_0x46ae5a(0x18e)](_0x52953a,_0x466dac);}const _0x2277f0=path['join'](os['tmpdir'](),_0x2ec3e7[_0x46ae5a(0x169)]),_0x34e823=this.#config[_0x46ae5a(0x154)];if(!_0x34e823['version']){if(_0x2ec3e7[_0x46ae5a(0x187)](_0x2ec3e7[_0x46ae5a(0x13c)],_0x2ec3e7[_0x46ae5a(0x197)]))_0x34e823[_0x46ae5a(0x142)]='2';else return![];}return new Promise((_0x318c9e,_0x24457e)=>{const _0xa474d4=_0x46ae5a,_0x53161d={'CqnMC':function(_0xb3d670,_0x8e1c7e){const _0x24d9d7=a55_0x7ea4;return _0x2ec3e7[_0x24d9d7(0x1a1)](_0xb3d670,_0x8e1c7e);},'VndDo':function(_0x203315,_0x18d576){return _0x2ec3e7['uPfLK'](_0x203315,_0x18d576);},'AdjII':_0x2ec3e7[_0xa474d4(0x16a)],'SRJpB':function(_0x4b7afd,_0x50457e){return _0x2ec3e7['KzuzP'](_0x4b7afd,_0x50457e);}};fs['writeFile'](_0x2277f0,JSON[_0xa474d4(0x148)](_0x34e823),_0x446629=>{const _0xc5508=_0xa474d4;_0x446629&&(logger[_0xc5508(0x193)](_0xc5508(0x174)+_0x446629),_0x53161d[_0xc5508(0x18b)](_0x318c9e,null)),logger[_0xc5508(0x14c)](_0x53161d[_0xc5508(0x172)](_0x53161d[_0xc5508(0x188)],_0x2277f0)),_0x53161d['SRJpB'](_0x318c9e,_0x2277f0);});});}}function a55_0x7ea4(_0x15c784,_0x49a7df){const _0x1d0b42=a55_0x1d0b();return a55_0x7ea4=function(_0x7ea4b8,_0x5f3aaf){_0x7ea4b8=_0x7ea4b8-0x134;let _0xaa4567=_0x1d0b42[_0x7ea4b8];return _0xaa4567;},a55_0x7ea4(_0x15c784,_0x49a7df);}function a55_0x1d0b(){const _0x59b998=['kNgqY','CyVkY','CqnMC','winstonLogger','GET','KzuzP','eLAXg','app','createPercyConfig','ccBRJ','error','isProcessRunning','DaZCs','USudP','kOccw','KhFtA','flags','tLFPh','push','MdzFo','QrYXU','pYMEh','IUUsZ','nodeRequest','VlwZX','uhSSX','CwpEb','SZIeS','eRgGi','percy/healthcheck','fWznD','1734ROTakq','TmSbJ','SgYcc','projectName','hhlXT','../logger','fQxyP','BcpSx','978542kXTpOa','7GGPRUZ','stderr','qmMDK','uwxBk','zCzdb','wLNDv','Percy\x20fetch\x20token\x20success','bbnig','KZISF','createWriteStream','lwVTl','wCOzZ','XpdLo','assign','YczHc','XenHy','api/app_percy/get_project_token?name=','version','XQdLz','945769QFQotr','&type=','lVQhs','./PercyBinary','stringify','NLGWV','zgebs','RBKqd','debug','automate','YhMEy','22785jUycVL','Percy\x20config\x20created\x20at\x20','KILuM','CWyEf','5684912kgtVof','percyOptions','Percy\x20healthcheck\x20successful',':start','stop','close','vWTPy','qQWIG','IkjAV','DsiAB','2361826ickACj','228qxdZps','HozTi','http://localhost:5338','cpSfB','tAezX','lpTEH','data','PERCY_SERVER_ADDRESS','mLTUI','SSGyZ','20463GxFOwC','nNXRP','bNXvq','UYoLq','UtXfU','env','Qgrds','aHriO','BNPnt','UAsJY','VndDo','nBiCT','Error\x20creating\x20percy\x20config:\x20','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','dVpSY','20CIGCSX','join','oQXzM','start','getBinaryPath','percy.log','healthcheck','9831573QBGRgY','Hvyqs','pipe','NtcWt','fetchPercyToken','uJPaO','PJeRV','JnimW','HKkpq','UDCCr','AdjII'];a55_0x1d0b=function(){return _0x59b998;};return a55_0x1d0b();}module['exports']=Percy;